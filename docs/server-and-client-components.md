# MoonWhale Voice-Over - Server and Client Components Documentation

This document provides a comprehensive guide to Server and Client Components in the MoonWhale Voice-Over project, built with Next.js 15.3.4 App Router pattern.

## ğŸ“‹ Overview

Based on the [Next.js Server and Client Components documentation](https://nextjs.org/docs/app/getting-started/server-and-client-components), this project leverages React Server Components for optimal performance while using Client Components for interactivity when needed.

**Current Implementation:**
- **Framework:** Next.js 15.3.4 with App Router
- **Default Rendering:** Server Components (Next.js default)
- **Client Components:** None implemented yet
- **Interactive Features:** Static content only (no user interactions)

## ğŸ“š Core Concepts

### **Server Components**
- Render on the server during request time or at build time
- Have access to server-side resources (databases, file systems, etc.)
- Cannot use browser-only APIs or interactive features
- Reduce client-side JavaScript bundle size
- Enable better SEO and faster initial page loads

### **Client Components**
- Render on the client (browser)
- Can use React hooks, event handlers, and browser APIs
- Required for interactive features and state management
- Need `'use client'` directive at the top of the file

### **Network Boundary**
The conceptual line that separates server and client environments in your component tree.

## ğŸ—ï¸ Current Implementation Analysis

### Root Layout (`src/app/layout.tsx`) - Server Component

```typescript
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      >
        {children}
      </body>
    </html>
  );
}
```

**Server Component Features:**
- âœ… **Metadata Export**: SEO-optimized metadata configuration
- âœ… **Font Optimization**: Server-side font loading with `next/font`
- âœ… **Static Rendering**: No interactive features, perfect for server rendering
- âœ… **CSS Processing**: Global styles imported at build time

### Home Page (`src/app/page.tsx`) - Server Component

```typescript
import Image from "next/image";

export default function Home() {
  return (
    <div className="grid grid-rows-[20px_1fr_20px]...">
      <main className="flex flex-col gap-[32px]...">
        <Image
          className="dark:invert"
          src="/next.svg"
          alt="Next.js logo"
          width={180}
          height={38}
          priority
        />
        {/* Static content */}
      </main>
    </div>
  );
}
```

**Server Component Features:**
- âœ… **Image Optimization**: Server-side `next/image` optimization
- âœ… **Static Content**: No state or interactions, ideal for server rendering
- âœ… **CSS Styling**: TailwindCSS classes processed at build time
- âœ… **SEO Friendly**: Content rendered on server for better search indexing

## ğŸ› ï¸ Implementation Guide

### 1. When to Use Server Components

**Perfect for:**
- Static content rendering
- Data fetching from databases
- Accessing server-side resources
- SEO-critical content
- Layout components without interactivity

**Examples for MoonWhale Voice-Over:**

```typescript
// Server Component for portfolio data fetching
export default async function PortfolioPage() {
  // This runs on the server
  const projects = await fetch('https://api.moonwhale.com/projects')
    .then(res => res.json());

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold mb-8">Our Portfolio</h1>
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        {projects.map((project) => (
          <ProjectCard key={project.id} project={project} />
        ))}
      </div>
    </div>
  );
}

// Server Component for service information
export default function ServicesPage() {
  const services = [
    { name: 'Voice-Over', description: 'Professional narration services' },
    { name: 'Commercial', description: 'TV and radio commercials' },
    { name: 'Audiobooks', description: 'Full-length audiobook narration' },
  ];

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold mb-8">Our Services</h1>
      {services.map((service) => (
        <ServiceCard key={service.name} service={service} />
      ))}
    </div>
  );
}
```

### 2. When to Use Client Components

**Required for:**
- React hooks (`useState`, `useEffect`, etc.)
- Event handlers (`onClick`, `onChange`, etc.)
- Browser-only APIs (`localStorage`, `window`, etc.)
- Interactive components
- Real-time features

**Examples for MoonWhale Voice-Over:**

```typescript
'use client'

import { useState } from 'react';

// Client Component for contact form
export default function ContactForm() {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    message: ''
  });
  const [isSubmitting, setIsSubmitting] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsSubmitting(true);
    
    try {
      await fetch('/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      });
      
      alert('Message sent successfully!');
      setFormData({ name: '', email: '', message: '' });
    } catch (error) {
      alert('Error sending message');
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="max-w-md mx-auto">
      <div className="mb-4">
        <label className="block text-sm font-medium mb-2">
          Name
        </label>
        <input
          type="text"
          value={formData.name}
          onChange={(e) => setFormData({...formData, name: e.target.value})}
          className="w-full px-3 py-2 border border-gray-300 rounded-md"
          required
        />
      </div>
      <div className="mb-4">
        <label className="block text-sm font-medium mb-2">
          Email
        </label>
        <input
          type="email"
          value={formData.email}
          onChange={(e) => setFormData({...formData, email: e.target.value})}
          className="w-full px-3 py-2 border border-gray-300 rounded-md"
          required
        />
      </div>
      <div className="mb-6">
        <label className="block text-sm font-medium mb-2">
          Message
        </label>
        <textarea
          value={formData.message}
          onChange={(e) => setFormData({...formData, message: e.target.value})}
          rows={4}
          className="w-full px-3 py-2 border border-gray-300 rounded-md"
          required
        />
      </div>
      <button
        type="submit"
        disabled={isSubmitting}
        className="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50"
      >
        {isSubmitting ? 'Sending...' : 'Send Message'}
      </button>
    </form>
  );
}
```

### 3. Audio Player Component (Client Component Example)

```typescript
'use client'

import { useState, useRef, useEffect } from 'react';

interface AudioPlayerProps {
  src: string;
  title: string;
}

export default function AudioPlayer({ src, title }: AudioPlayerProps) {
  const [isPlaying, setIsPlaying] = useState(false);
  const [currentTime, setCurrentTime] = useState(0);
  const [duration, setDuration] = useState(0);
  const audioRef = useRef<HTMLAudioElement>(null);

  useEffect(() => {
    const audio = audioRef.current;
    if (!audio) return;

    const updateTime = () => setCurrentTime(audio.currentTime);
    const updateDuration = () => setDuration(audio.duration);

    audio.addEventListener('timeupdate', updateTime);
    audio.addEventListener('loadedmetadata', updateDuration);

    return () => {
      audio.removeEventListener('timeupdate', updateTime);
      audio.removeEventListener('loadedmetadata', updateDuration);
    };
  }, []);

  const togglePlay = () => {
    if (audioRef.current) {
      if (isPlaying) {
        audioRef.current.pause();
      } else {
        audioRef.current.play();
      }
      setIsPlaying(!isPlaying);
    }
  };

  const formatTime = (time: number) => {
    const minutes = Math.floor(time / 60);
    const seconds = Math.floor(time % 60);
    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
  };

  return (
    <div className="bg-white rounded-lg shadow-md p-6">
      <h3 className="text-lg font-semibold mb-4">{title}</h3>
      <audio ref={audioRef} src={src} />
      
      <div className="flex items-center space-x-4">
        <button
          onClick={togglePlay}
          className="bg-blue-600 text-white p-2 rounded-full hover:bg-blue-700"
        >
          {isPlaying ? 'â¸ï¸' : 'â–¶ï¸'}
        </button>
        
        <div className="flex-1">
          <div className="bg-gray-200 rounded-full h-2">
            <div
              className="bg-blue-600 h-2 rounded-full"
              style={{ width: `${(currentTime / duration) * 100}%` }}
            />
          </div>
        </div>
        
        <span className="text-sm text-gray-600">
          {formatTime(currentTime)} / {formatTime(duration)}
        </span>
      </div>
    </div>
  );
}
```

### 4. Theme Toggle Component (Client Component Example)

```typescript
'use client'

import { useState, useEffect } from 'react';

export default function ThemeToggle() {
  const [isDark, setIsDark] = useState(false);

  useEffect(() => {
    // Check for saved theme preference or default to light mode
    const savedTheme = localStorage.getItem('theme');
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    
    setIsDark(savedTheme === 'dark' || (!savedTheme && systemPrefersDark));
  }, []);

  useEffect(() => {
    // Apply theme to document
    if (isDark) {
      document.documentElement.classList.add('dark');
      localStorage.setItem('theme', 'dark');
    } else {
      document.documentElement.classList.remove('dark');
      localStorage.setItem('theme', 'light');
    }
  }, [isDark]);

  return (
    <button
      onClick={() => setIsDark(!isDark)}
      className="p-2 rounded-md bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
      aria-label={`Switch to ${isDark ? 'light' : 'dark'} mode`}
    >
      {isDark ? 'â˜€ï¸' : 'ğŸŒ™'}
    </button>
  );
}
```

## ğŸ¨ Composition Patterns

### 1. Mixing Server and Client Components

```typescript
// Server Component (app/portfolio/page.tsx)
import PortfolioFilter from './PortfolioFilter'; // Client Component
import ProjectCard from './ProjectCard'; // Server Component

export default async function PortfolioPage() {
  const projects = await getProjects(); // Server-side data fetching

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold mb-8">Portfolio</h1>
      
      {/* Client Component for filtering */}
      <PortfolioFilter />
      
      {/* Server Component for static content */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
        {projects.map((project) => (
          <ProjectCard key={project.id} project={project} />
        ))}
      </div>
    </div>
  );
}
```

### 2. Passing Server Data to Client Components

```typescript
// Server Component
export default async function VoiceOverShowcase() {
  const voiceOvers = await getVoiceOvers();

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold mb-8">Voice-Over Showcase</h1>
      
      {/* Pass server data to client component */}
      <AudioPlaylist voiceOvers={voiceOvers} />
    </div>
  );
}

// Client Component (app/components/AudioPlaylist.tsx)
'use client'

import { useState } from 'react';
import AudioPlayer from './AudioPlayer';

interface VoiceOver {
  id: string;
  title: string;
  audioUrl: string;
  category: string;
}

interface AudioPlaylistProps {
  voiceOvers: VoiceOver[];
}

export default function AudioPlaylist({ voiceOvers }: AudioPlaylistProps) {
  const [selectedCategory, setSelectedCategory] = useState('all');
  const [currentPlaying, setCurrentPlaying] = useState<string | null>(null);

  const filteredVoiceOvers = selectedCategory === 'all' 
    ? voiceOvers 
    : voiceOvers.filter(vo => vo.category === selectedCategory);

  return (
    <div>
      <div className="mb-6">
        <select
          value={selectedCategory}
          onChange={(e) => setSelectedCategory(e.target.value)}
          className="px-3 py-2 border border-gray-300 rounded-md"
        >
          <option value="all">All Categories</option>
          <option value="commercial">Commercial</option>
          <option value="narration">Narration</option>
          <option value="character">Character</option>
        </select>
      </div>

      <div className="space-y-4">
        {filteredVoiceOvers.map((voiceOver) => (
          <AudioPlayer
            key={voiceOver.id}
            src={voiceOver.audioUrl}
            title={voiceOver.title}
            isActive={currentPlaying === voiceOver.id}
            onPlay={() => setCurrentPlaying(voiceOver.id)}
          />
        ))}
      </div>
    </div>
  );
}
```

## âš¡ Performance Optimizations

### 1. Lazy Loading Client Components

```typescript
import { lazy, Suspense } from 'react';

// Lazy load heavy client components
const AudioPlayer = lazy(() => import('../components/AudioPlayer'));
const ContactForm = lazy(() => import('../components/ContactForm'));

export default function ContactPage() {
  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold mb-8">Contact Us</h1>
      
      <Suspense fallback={<div className="animate-pulse bg-gray-200 h-64 rounded-lg" />}>
        <ContactForm />
      </Suspense>
      
      <div className="mt-12">
        <h2 className="text-2xl font-bold mb-6">Voice Samples</h2>
        <Suspense fallback={<div className="animate-pulse bg-gray-200 h-32 rounded-lg" />}>
          <AudioPlayer src="/samples/demo.mp3" title="Demo Reel" />
        </Suspense>
      </div>
    </div>
  );
}
```

### 2. Server-Only Utilities

```typescript
// lib/server-utils.ts
import 'server-only'; // Prevents accidental client-side usage

export async function getProjects() {
  const response = await fetch(`${process.env.API_BASE_URL}/projects`, {
    headers: {
      'Authorization': `Bearer ${process.env.API_SECRET}`,
    },
  });
  
  if (!response.ok) {
    throw new Error('Failed to fetch projects');
  }
  
  return response.json();
}

export async function getVoiceOverSamples() {
  // Server-only database access
  const samples = await db.voiceOvers.findMany({
    where: { isPublic: true },
    orderBy: { createdAt: 'desc' },
  });
  
  return samples;
}
```

### 3. Client-Only Components

```typescript
// components/client-only/BrowserFeatures.tsx
'use client'

import { useEffect, useState } from 'react';

export default function BrowserFeatures() {
  const [browserInfo, setBrowserInfo] = useState({
    userAgent: '',
    screenWidth: 0,
    supportsAudio: false,
  });

  useEffect(() => {
    setBrowserInfo({
      userAgent: navigator.userAgent,
      screenWidth: window.innerWidth,
      supportsAudio: 'HTMLAudioElement' in window,
    });
  }, []);

  return (
    <div className="text-sm text-gray-600">
      <p>Browser: {browserInfo.userAgent.split(' ')[0]}</p>
      <p>Screen Width: {browserInfo.screenWidth}px</p>
      <p>Audio Support: {browserInfo.supportsAudio ? 'Yes' : 'No'}</p>
    </div>
  );
}
```

## ğŸ”§ Best Practices

### 1. Component Boundary Decisions

```typescript
// âŒ Avoid: Making entire page client component
'use client'
export default function ServicesPage() {
  const [activeTab, setActiveTab] = useState('voice-over');
  // Entire page now runs on client
}

// âœ… Prefer: Split into Server and Client components
export default function ServicesPage() {
  return (
    <div className="container mx-auto px-4 py-8">
      <h1>Our Services</h1> {/* Server rendered */}
      <ServiceTabs /> {/* Client component for interactivity */}
      <ServiceList /> {/* Server component for static content */}
    </div>
  );
}
```

### 2. Third-Party Component Wrapping

```typescript
// components/ClientWrapper.tsx
'use client'

import { ReactNode } from 'react';

interface ClientWrapperProps {
  children: ReactNode;
}

export default function ClientWrapper({ children }: ClientWrapperProps) {
  return <>{children}</>;
}

// Usage in Server Component
import ClientWrapper from './ClientWrapper';
import { SomeThirdPartyComponent } from 'third-party-lib';

export default function ServerPage() {
  return (
    <div>
      <h1>Server rendered content</h1>
      <ClientWrapper>
        <SomeThirdPartyComponent />
      </ClientWrapper>
    </div>
  );
}
```

### 3. Environment Protection

```typescript
// lib/api.ts
import 'server-only';

export async function getSecretData() {
  // This code never runs on the client
  const apiKey = process.env.SECRET_API_KEY;
  
  const response = await fetch('https://api.internal.com/data', {
    headers: {
      'Authorization': `Bearer ${apiKey}`,
    },
  });
  
  return response.json();
}
```

## ğŸš€ Implementation Roadmap

### Phase 1: Basic Interactivity
1. **Contact Form**: Client Component with form validation
2. **Audio Player**: Basic play/pause functionality
3. **Mobile Navigation**: Interactive menu toggle

### Phase 2: Enhanced Features
1. **Portfolio Filter**: Client-side filtering and search
2. **Theme Toggle**: Dark/light mode switching
3. **Audio Playlist**: Advanced audio controls

### Phase 3: Advanced Interactions
1. **Real-time Chat**: WebSocket integration
2. **Voice Recording**: Browser audio recording
3. **Interactive Portfolio**: Drag and drop, animations

## ğŸ“ Recommended Project Structure

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (marketing)/            # Server Components
â”‚   â”‚   â”œâ”€â”€ about/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx        # Server Component
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â””â”€â”€ page.tsx        # Server Component
â”‚   â”œâ”€â”€ contact/
â”‚   â”‚   â”œâ”€â”€ page.tsx            # Server Component wrapper
â”‚   â”‚   â””â”€â”€ ContactForm.tsx     # Client Component
â”‚   â””â”€â”€ portfolio/
â”‚       â”œâ”€â”€ page.tsx            # Server Component
â”‚       â””â”€â”€ PortfolioFilter.tsx # Client Component
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ client/                 # Client Components
â”‚   â”‚   â”œâ”€â”€ AudioPlayer.tsx
â”‚   â”‚   â”œâ”€â”€ ContactForm.tsx
â”‚   â”‚   â”œâ”€â”€ ThemeToggle.tsx
â”‚   â”‚   â””â”€â”€ Navigation.tsx
â”‚   â”œâ”€â”€ server/                 # Server Components
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â”œâ”€â”€ Footer.tsx
â”‚   â”‚   â””â”€â”€ ProjectCard.tsx
â”‚   â””â”€â”€ ui/                     # Shared Components
â”‚       â”œâ”€â”€ Button.tsx
â”‚       â””â”€â”€ Card.tsx
â””â”€â”€ lib/
    â”œâ”€â”€ server-utils.ts         # Server-only utilities
    â””â”€â”€ client-utils.ts         # Client-only utilities
```

## ğŸ“š Additional Resources

- [Next.js Server and Client Components](https://nextjs.org/docs/app/getting-started/server-and-client-components)
- [React Server Components](https://nextjs.org/docs/app/building-your-application/rendering/server-components)
- [Client Components](https://nextjs.org/docs/app/building-your-application/rendering/client-components)
- [Composition Patterns](https://nextjs.org/docs/app/building-your-application/rendering/composition-patterns)

---

**Last Updated:** [Current Date]  
**Maintainer:** MoonWhale Voice-Over Team 